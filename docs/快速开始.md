# 快速开始

## 启动步骤

### 1. 安装依赖
```bash
pnpm install
```

### 2. 配置环境变量
复制 `.env.example` 为 `.env` 并修改配置：
```bash
cp .env.example .env
```

编辑 `.env` 文件，设置漫画库路径（可选）：
```env
MANGA_LIBRARY_PATH=D:/Manga,E:/Comics
```

### 3. 启动服务

我们提供了高度自动化的 PowerShell 脚本，能够自动清理旧进程、检查环境并获取局域网 IP。

#### 开发模式 (推荐)
```powershell
./scripts/dev.ps1
```
> **特性**: 自动清理进程、自动创建 .env (如果缺失)、实时预览、显示局域网访问 IP。

#### 生产模式 (单体运行)
```powershell
./scripts/prod.ps1
```
> **特性**: 编译前端、后端自动托管静态资源。只需一个端口即可访问全站，适合实际使用。

#### 传统手动启动
```bash
pnpm start
```

### 4. 访问应用
- **本地访问**: `http://localhost:3000` (生产模式) 或 `http://localhost:5173` (开发模式)
- **局域网访问**: 请查看 `dev.ps1` 启动时显示的 IP，例如 `http://192.168.x.x:3000`
- **后端 API 健康检查**: `http://localhost:3000/api/health`

> 💡 **提示**: 手机访问前请确保电脑防火墙已允许 Node.js 入站连接。详细操作见 [局域网访问指南](./局域网访问指南.md)。

### 5. 添加漫画库 (书库)
启动应用后，请按以下步骤添加漫画：
1. 访问左侧菜单 **"Libraries"**。
2. 点击右上角 **"Add Library"**。
3. 输入书库名称（如 "My Manga"）和本地文件夹路径（如 `D:\Manga`）。
4. 系统将自动扫描该路径下的漫画文件。

## 常见问题

### 端口占用
- **前端端口**: 如果 5173 端口被占用，Vite 会自动尝试下一个端口
- **后端端口**: 可在 `.env` 文件中修改 `PORT` 变量

### 样式不生效
确保正在运行 `pnpm dev` 且 `src/main.css` 已正确引入

### 数据库位置
数据库文件默认保存在 `data/pica.db`，可在 `.env` 中修改 `DB_PATH`。

### 扫描失败
- 检查漫画目录路径是否正确
- 确保目录包含图片文件（.jpg, .png, .webp 等）
- 查看控制台错误信息

## 环境要求
- Node.js 18+
- pnpm 8+
- Windows/macOS/Linux

## 项目结构
```
pica/
├── server/           # 后端服务器
│   ├── index.js     # 服务器入口
│   ├── db/          # 数据库模块
│   ├── routes/      # API 路由
│   └── utils/       # 工具函数（扫描器等）
├── src/             # 前端源码
│   ├── main.js      # 前端入口
│   ├── main.css     # 全局样式
│   ├── pages/       # 页面 (Library, Reader, etc.)
│   └── components/  # 组件 (Card, Sidebar, etc.)
├── docs/            # 项目文档
├── data/            # 数据库和缓存（自动生成）
└── index.html       # HTML 入口
```
