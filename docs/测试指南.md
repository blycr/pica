# 新功能测试指南

## 🚀 快速开始

### 1. 确保服务正在运行
```bash
# 后端服务（端口 3000）
pnpm server:dev

# 前端服务（端口 5173）
pnpm dev
```

---

## 📋 功能测试清单

### ✅ 历史记录与收藏夹

#### 测试首页"继续阅读"功能
1. **访问首页**
   - 打开浏览器访问 `http://localhost:5173/`
   - 应该看到三个部分：Continue Reading、My Favorites、Recently Added

2. **测试继续阅读**
   - 点击任意漫画卡片
   - 进入漫画详情页
   - 点击某个章节开始阅读
   - 阅读几页后返回首页（点击浏览器返回按钮或侧边栏的Home）
   - 验证：首页的"Continue Reading"部分应该显示刚才阅读的漫画
   - 验证：卡片底部应该显示阅读进度条

3. **测试快速跳转**
   - 点击"Continue Reading"中的卡片
   - 验证：应该直接跳转到上次阅读的章节和页面位置

4. **测试收藏夹**
   - 在漫画详情页点击收藏按钮（心形图标）
   - 返回首页
   - 验证："My Favorites"部分应该显示刚才收藏的漫画
   - 点击"View All →"查看完整收藏列表

---

### ✅ 书库管理

#### 测试书库列表
1. **访问书库管理页面**
   - 点击侧边栏的"Libraries"
   - 应该看到所有书库的列表（如果是首次使用，可能为空）

2. **创建新书库**
   - 点击右上角的"+ Add Library"按钮
   - 在弹出的对话框中输入：
     - Library Name: `测试书库`
     - Library Path: `D:/TestManga` （或其他有效路径）
     - Description: `这是一个测试书库`
   - 点击确定
   - 验证：新书库应该出现在列表中

3. **查看书库详情**
   - 每个书库卡片应该显示：
     - 书库名称和状态（Active/Inactive）
     - 描述信息
     - 路径
     - 漫画数量
     - 创建时间

4. **编辑书库**
   - 点击某个书库的"Edit"按钮
   - 修改名称或描述
   - 验证：修改应该立即生效

5. **浏览书库**
   - 点击"Browse"按钮
   - 验证：应该跳转到Library页面，并筛选该书库的漫画

6. **删除书库**
   - 点击"Delete"按钮
   - 确认删除
   - 验证：如果书库下有漫画，应该提示无法删除
   - 验证：空书库应该可以成功删除

---

### ✅ 元数据管理

#### 测试元数据搜索
1. **访问元数据管理页面**
   - 点击侧边栏的"Metadata"
   - 应该看到搜索界面

2. **搜索元数据**
   - 在搜索框中输入漫画标题，例如：`进击的巨人`
   - 点击"Search"按钮
   - 验证：应该显示搜索结果（目前是模拟数据）

3. **查看搜索结果**
   - 每个结果应该显示：
     - 封面图片（如果有）
     - 标题和别名
     - 作者信息
     - 发布年份
     - 状态（连载中/完结）
     - 匹配评分
     - 简介
     - 类型标签

4. **应用元数据**
   - 点击某个结果的"Apply to Manga"按钮
   - 输入要应用的漫画ID（可以从Library页面获取）
   - 验证：应该显示成功提示

---

## 🔍 API测试

### 使用浏览器或Postman测试API

#### 1. 测试继续阅读API
```bash
GET http://localhost:3000/api/history/continue-reading?limit=5
```
**预期响应**：返回最近阅读的5个漫画

#### 2. 测试阅读历史API
```bash
GET http://localhost:3000/api/history?page=1&limit=10
```
**预期响应**：返回分页的阅读历史记录

#### 3. 测试收藏夹API
```bash
GET http://localhost:3000/api/history/favorites?limit=10
```
**预期响应**：返回收藏的漫画列表

#### 4. 测试书库列表API
```bash
GET http://localhost:3000/api/libraries
```
**预期响应**：返回所有书库

#### 5. 测试元数据搜索API
```bash
GET http://localhost:3000/api/metadata/search?title=进击的巨人
```
**预期响应**：返回元数据搜索结果

---

## 🐛 常见问题排查

### 问题1：首页不显示继续阅读
**可能原因**：
- 没有阅读历史记录
- 数据库中没有数据

**解决方法**：
1. 先去Library页面浏览漫画
2. 点击进入某个漫画的阅读器
3. 阅读几页后返回首页

### 问题2：书库管理页面显示错误
**可能原因**：
- 后端服务未启动
- API路由未正确注册

**解决方法**：
1. 检查后端控制台是否有错误
2. 确认 `server/index.js` 中已导入并注册 `historyRoutes`
3. 重启后端服务

### 问题3：元数据搜索无结果
**说明**：
- 当前版本返回模拟数据
- 需要集成外部API才能获取真实数据

**未来改进**：
- 集成 AniList API
- 集成 MyAnimeList API
- 集成 Bangumi API

### 问题4：图标不显示
**可能原因**：
- Icons 未正确导入

**解决方法**：
1. 检查 `src/utils/icons.js` 是否包含所需图标
2. 确认组件中已导入 Icons
3. 检查浏览器控制台是否有错误

---

## 📊 数据验证

### 检查数据库
```bash
# 进入项目目录
cd c:\Users\blycr\pica

# 查看数据库文件
ls data/pica.db
```

### 使用SQLite查看数据
```bash
# 安装SQLite（如果未安装）
# Windows: 下载 sqlite-tools

# 打开数据库
sqlite3 data/pica.db

# 查看表结构
.tables

# 查看阅读历史
SELECT * FROM reading_history ORDER BY read_at DESC LIMIT 10;

# 查看收藏的漫画
SELECT * FROM manga WHERE is_favorite = 1;

# 查看书库
SELECT * FROM libraries;

# 退出
.quit
```

---

## ✨ 功能亮点

### 1. 智能继续阅读
- ✅ 自动记录阅读位置
- ✅ 显示阅读进度
- ✅ 一键跳转到上次位置

### 2. 美观的UI设计
- ✅ 玻璃拟态风格
- ✅ 流畅的动画效果
- ✅ 响应式布局

### 3. 完善的书库管理
- ✅ 多书库支持
- ✅ 书库统计信息
- ✅ 灵活的管理操作

### 4. 元数据增强
- ✅ 搜索元数据
- ✅ 详细信息展示
- ✅ 一键应用

---

## 📝 测试报告模板

### 测试日期：________

#### 功能测试结果

| 功能 | 状态 | 备注 |
|------|------|------|
| 首页继续阅读 | ☐ 通过 ☐ 失败 | |
| 收藏夹显示 | ☐ 通过 ☐ 失败 | |
| 书库列表 | ☐ 通过 ☐ 失败 | |
| 创建书库 | ☐ 通过 ☐ 失败 | |
| 编辑书库 | ☐ 通过 ☐ 失败 | |
| 删除书库 | ☐ 通过 ☐ 失败 | |
| 元数据搜索 | ☐ 通过 ☐ 失败 | |
| 应用元数据 | ☐ 通过 ☐ 失败 | |

#### 发现的问题
1. 
2. 
3. 

#### 改进建议
1. 
2. 
3. 

---

## 🎯 下一步

测试完成后，可以考虑：
1. 集成外部元数据API
2. 优化UI细节
3. 添加更多统计功能
4. 实现批量操作
5. 添加导出/导入功能

祝测试顺利！🎉
